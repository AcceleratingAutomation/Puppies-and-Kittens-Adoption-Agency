name: Manual Automated Checks

on:
  # checkov:skip=CKV_GHA_7
  workflow_dispatch:
    inputs:
      prettier:
        description: "Run Prettier"
        type: boolean
        default: true
      super-linter:
        description: "Run Super-Linter"
        type: boolean
        default: true
      jest-unit-tests:
        description: "Run Jest Unit Tests"
        type: boolean
        default: true
      cypress-component-tests:
        description: "Run Cypress Component Tests"
        type: boolean
        default: true
      playwright-visual-tests:
        description: "Run Playwright Visual Tests"
        type: boolean
        default: true
      merge-playwright-visual-reports:
        description: "Run Merge Playwright Reports"
        type: boolean
        default: true
      upload-playwright-report-to-pages:
        description: "Run Upload Playwright Report To Github Pages"
        type: boolean
        default: true
      slack-notification:
        description: "Run Slack Notification"
        type: boolean
        default: true

env:
  ALGORITHM: ${{ vars.ALGORITHM }}
  EXPIRY: ${{ vars.EXPIRY }}
  ISSUER: ${{ vars.ISSUER }}
  REACT_APP_ENV: ${{ vars.REACT_APP_ENV }}
  SECRET: ${{ secrets.SECRET }}
  SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
  TEST_ENV: ${{ vars.TEST_ENV }}
  TEST_PASSWORD: ${{ secrets.TEST_PASSWORD }}
  TEST_USERNAME: ${{ secrets.TEST_USERNAME }}

jobs:
  run-prettier:
    name: Formatting
    if: github.event.inputs.prettier == 'true'
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/prettier.yml@main

  run-super-linter:
    name: Linters
    if: github.event.inputs.super-linter == 'true'
    permissions:
      contents: read
      packages: read
      statuses: write
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/super-linter.yml@main

  run-jest-unit-tests:
    name: Unit Tests
    if: github.event.inputs.jest-unit-tests == 'true'
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/jest-unit-tests.yml@main

  run-cypress-component-tests:
    name: Component Tests
    if: github.event.inputs.cypress-component-tests == 'true'
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/cypress-component-tests.yml@main

  run-playwright-visual-tests:
    name: Visual Tests
    if: github.event.inputs.playwright-visual-tests == 'true'
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/playwright-visual-tests.yml@main
    secrets: inherit

  run-merge-playwright-visual-reports:
    name: Merge Reports
    if: always() && needs.run-playwright-visual-tests.result != 'skipped' && needs.run-playwright-visual-tests.result != 'cancelled' && github.event.inputs.merge-playwright-visual-reports == 'true'
    needs: [run-playwright-visual-tests]
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/merge-playwright-visual-reports.yml@main

  run-upload-playwright-report-to-pages:
    name: Playwright Visual Report On GitHub Pages
    if: always() && needs.run-merge-playwright-visual-reports.result != 'skipped' && needs.run-merge-playwright-visual-reports.result != 'cancelled' && github.event.inputs.upload-playwright-report-to-pages == 'true'
    needs: [run-merge-playwright-visual-reports]
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/upload-playwright-report-to-pages.yml@main

  slack-notification:
    name: Notifications
    if: always() && needs.run-merge-playwright-visual-reports.result != 'cancelled' && github.event.inputs.slack-notification == 'true'
    needs:
      [
        run-prettier,
        run-super-linter,
        run-jest-unit-tests,
        run-cypress-component-tests,
        run-playwright-visual-tests,
        run-merge-playwright-visual-reports,
        run-upload-playwright-report-to-pages,
      ]
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/slack-notification.yml@main
    secrets: inherit
