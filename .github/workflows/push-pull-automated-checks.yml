name: Push and Pull Automated Checks

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  ALGORITHM: ${{ vars.ALGORITHM }}
  EXPIRY: ${{ vars.EXPIRY }}
  ISSUER: ${{ vars.ISSUER }}
  REACT_APP_ENV: ${{ vars.REACT_APP_ENV }}
  SECRET: ${{ secrets.SECRET }}
  SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
  TEST_ENV: ${{ vars.TEST_ENV }}
  TEST_PASSWORD: ${{ secrets.TEST_PASSWORD }}
  TEST_USERNAME: ${{ secrets.TEST_USERNAME }}

jobs:
  run-prettier:
    name: Formatting
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/prettier.yml@main

  run-super-linter:
    name: Linters
    permissions:
      contents: read
      packages: read
      statuses: write
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/super-linter.yml@main

  run-jest-unit-tests:
    name: Unit Tests
    needs: [run-prettier, run-super-linter]
    permissions:
      contents: write
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/jest-unit-tests.yml@main

  run-playwright-visual-tests:
    name: Playwright Tests
    needs: [run-jest-unit-tests]
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/playwright-visual-tests.yml@main
    secrets: inherit

  run-merge-playwright-visual-reports:
    name: Playwright Tests
    if: always() && needs.run-playwright-visual-tests.result != 'skipped' && needs.run-playwright-visual-tests.result != 'cancelled'
    needs: [run-playwright-visual-tests]
    permissions:
      contents: write
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/merge-playwright-visual-reports.yml@main

  slack-notification:
    name: Notifications
    if: always() && needs.run-merge-playwright-visual-reports.result != 'cancelled'
    needs: [run-merge-playwright-visual-reports]
    uses: AcceleratingAutomation/Puppies-and-Kittens-Adoption-Agency/.github/workflows/slack-notification.yml@main
    secrets: inherit
